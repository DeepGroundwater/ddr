# Benchmark configuration for comparing DDR vs DiffRoute
# Extends standard DDR config format with DiffRoute options

defaults:
  - _self_
  - hydra: settings

# Standard DDR config (same as example_config.yaml)
mode: testing
geodataset: merit
name: benchmarks-v${oc.env:BENCHMARKS_VERSION,dev}-${geodataset}
device: 1

data_sources:
  attributes: /projects/mhpi/tbindas/ddr/data/merit_global_attributes_v2.nc
  geospatial_fabric_gpkg: /projects/mhpi/data/MERIT/raw/continent/riv_pfaf_7_MERIT_Hydro_v07_Basins_v01_bugfix1.shp
  conus_adjacency: /projects/mhpi/tbindas/ddr/data/merit_conus_adjacency.zarr
  gages_adjacency: /projects/mhpi/tbindas/ddr/data/merit_gages_conus_adjacency.zarr
  statistics: /projects/mhpi/tbindas/ddr/data/statistics
  streamflow: /projects/mhpi/tbindas/ddr/data/merit_dhbv2_UH_retrospective
  observations: /projects/mhpi/data/icechunk/usgs_daily_observations
  gages: /projects/mhpi/tbindas/ddr/references/gage_info/gages_3000.csv
  reservoir_params: /projects/mhpi/tbindas/ddr/data/merit_reservoir_params.csv

params:
  save_path: ./
  use_reservoir: true
  min_reservoir_area_km2: 5.0

experiment:
  batch_size: 365
  start_time: 1995/10/01
  end_time: 2010/09/30
  warmup: 3
  checkpoint: /projects/mhpi/tbindas/ddr/output/ddr-v0.6.2.dev0+g8210dce90.d20260223-merit-training/2026-02-26_10-10-56/saved_models/_ddr-v0.6.2.dev0+g8210dce90.d20260223-merit-training_epoch_5_mb_43.pt

kan:
  hidden_size: 41
  input_var_names:
    - FW
    - aridity
    - meanelevation
    - meanP
    - NDVI
    - meanslope
    - log10_uparea
    - glaciers
    - ETPOT_Hargr
    - Porosity
  num_hidden_layers: 2
  learnable_parameters:
    - q_spatial
    - top_width
    - side_slope
    - n
    - x_storage
  grid: 50
  k: 2
  use_graph_context: true

# === DiffRoute-specific configuration ===
diffroute:
  # Enable/disable DiffRoute comparison
  enabled: false

  # Impulse Response Function model
  # Options: muskingum, linear_storage, nash_cascade, pure_lag, hayami
  irf_fn: muskingum

  # Maximum delay for LTI router (number of timesteps)
  max_delay: 100

  # Timestep in days (3600/86400 = 1 hour)
  dt: 0.0416667

  # Muskingum k parameter (wave travel time through reach) in days
  # Must be in same units as dt. For stability: k >= dt / (2*(1-x))
  # k = reach_length / wave_celerity
  # 0.1042 days = 9000s = 2.5 hours (RAPID default)
  k: 0.1042

  # Muskingum x parameter (weighting factor, typically 0-0.5)
  # x=0 gives pure reservoir behavior, x=0.5 gives pure translation
  x: 0.3

# === Optional baseline comparison ===
summed_q_prime: /projects/mhpi/tbindas/ddr/output/ddr-v0.3.2.dev10+g2ffbf380e.d20260207-merit-q_prime/2026-02-07_19-50-49/summed_q_prime.zarr
