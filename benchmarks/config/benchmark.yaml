# Benchmark configuration for comparing DDR vs DiffRoute
# Extends standard DDR config format with DiffRoute options

defaults:
  - _self_
  - hydra: settings

# Standard DDR config (same as example_config.yaml)
mode: testing
geodataset: merit
name: benchmark-${now:%Y-%m-%d_%H-%M-%S}
device: 4

data_sources:
  attributes: /projects/mhpi/tbindas/ddr/data/merit_global_attributes_v2.nc
  geospatial_fabric_gpkg: /projects/mhpi/data/MERIT/raw/continent/riv_pfaf_7_MERIT_Hydro_v07_Basins_v01_bugfix1.shp
  conus_adjacency: /projects/mhpi/tbindas/ddr/data/merit_conus_adjacency.zarr
  gages_adjacency: /projects/mhpi/tbindas/ddr/data/merit_gages_conus_adjacency.zarr
  statistics: /projects/mhpi/tbindas/ddr/data/statistics
  streamflow: /projects/mhpi/tbindas/ddr/data/merit_dhbv2_UH_retrospective
  observations: /projects/mhpi/data/icechunk/usgs_daily_observations
  gages: /projects/mhpi/tbindas/ddr/streamflow_datasets/gage_info/dhbv2_gages.csv

params:
  save_path: ./
  parameter_ranges:
    n: [0.02, 0.2]
    q_spatial: [0.0, 1.0]
    top_width: [1.0, 6000.0]
    side_slope: [0.5, 50.0]
  log_space_parameters: [top_width, side_slope]
  defaults:
    p_spatial: 21
  tau: 3

experiment:
  batch_size: 64
  start_time: 1995/10/01
  end_time: 2010/09/30
  warmup: 3
  checkpoint: null  # Set path to trained DDR model checkpoint

kan:
  hidden_size: 21
  input_var_names:
    - SoilGrids1km_clay
    - aridity
    - meanelevation
    - meanP
    - NDVI
    - meanslope
    - log10_uparea
    - SoilGrids1km_sand
    - ETPOT_Hargr
    - Porosity
  num_hidden_layers: 2
  learnable_parameters:
    - n
    - q_spatial
    - top_width
    - side_slope
  grid: 50
  k: 2

# === DiffRoute-specific configuration ===
diffroute:
  # Enable/disable DiffRoute comparison
  enabled: true

  # Impulse Response Function model
  # Options: muskingum, linear_storage, nash_cascade, pure_lag, hayami
  irf_fn: muskingum

  # Maximum delay for LTI router (number of timesteps)
  max_delay: 100

  # Timestep in days (3600/86400 = 1 hour)
  dt: 0.0416667

  # Muskingum k parameter (wave travel time through reach) in days
  # Must be in same units as dt. For stability: k >= dt / (2*(1-x))
  # null = use dt (1 hour), or specify uniform value in days
  # For reference: k = reach_length / wave_celerity
  # Example: 0.0416667 days = 1 hour (same as dt)
  k: 0.0416667

  # Muskingum x parameter (weighting factor, typically 0-0.5)
  # x=0 gives pure reservoir behavior, x=0.5 gives pure translation
  x: 0.3
